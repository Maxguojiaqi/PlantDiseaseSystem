<!doctype html>
<html>

<head>
    <link rel="icon" href = "../../data/1492526805_Flag_of_Canada.png">
    <meta charset="UTF-8">
    <title>Plant Diease Model</title>

    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
    <link rel="stylesheet" href="https://openlayers.org/en/v4.2.0/css/ol.css" type="text/css">
    <script src="https://openlayers.org/en/v4.2.0/build/ol.js"></script>


    <meta name="viewport" content="width=device-width, initial-scale=1">
<!--    <script src="https://openlayers.org/en/v4.0.1/build/ol.js" type="text/javascript"></script>-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>



    <!-- // <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" type="text/javascript"></script> -->
    <script src="../css/Semantic-UI-CSS-master/semantic.js" type="text/javascript"></script>
    <link rel="stylesheet" href="../css/Semantic-UI-CSS-master/semantic.css" type="text/css">
    <link rel="stylesheet" href="../css/plant-disease.css" type="text/css">
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.3/proj4.js" type="text/javascript"></script> -->
    <script src="../lib/proj4js/proj4.js"></script>
   <!-- below is error handleing -->
   <!-- <script>window.onerror = function(e){alert("an error occured" + e);}</script> -->
    <script src="../lib/shp2geo/jszip.js" type="text/javascript"></script>
    <script src="../lib/shp2geo/jszip-utils.js" type="text/javascript"></script>    
    <script src="../lib/shp2geo/preprocess.js" type="text/javascript"></script>
    <script src="../lib/shp2geo/preview.js" type="text/javascript"></script>


</head>

<body>


<div id="tab-container">
    <div class="ui top attached pointing menu">
        <div class="active item" data-tab="first" style="cursor:pointer">
          <!-- <i class ="mouse pointer icon"></i> -->
            <h style ="font-style:courier; font-size:170%;" > Canola </h>  
          </div>

        <div class="item" data-tab="second" style="cursor:pointer">
          <!-- <i class ="configure icon"></i> -->
           <h style ="font-style:courier; font-size:170%;" > Corn </h>  
          </div>

        <div class="item" data-tab="third" style="cursor:pointer">
          <!-- <i class ="database icon"></i> -->
            <h style ="font-style:courier; font-size:170%;" > Wheat </h> 
          </div>

          <div class="item" data-tab="fourth" style="cursor:pointer">
          <!-- <i class ="database icon"></i> -->
            <h style ="font-style:courier; font-size:170%;" > Information </h> 
          </div>
    </div>


    <div data-tab= "first" class="ui bottom attached active tab segment">
                               
        <h3>  1.Select an Area of Interest for Canola by Clicking </h3>                    
        <div class="ui segment">  
        <span class="title-main"class="ui header">Click submit when finished</span>
        <div>
        <br>
        <button id ="AoiData" class="positive ui button">Submit</button>
        </div> 
        </div>


        <h3>  2.Enter required Data </h3>             


    <div class="ui segment">  
        <div class="ui right labeled input">
            <input placeholder ="Enter rainfall.." type ="text">
            <div class="ui basic label">
                mm
            </div>
        </div>
        <br>
        <br>

        <div class="ui right labeled input">
            <input id ="temperature" placeholder ="Enter temperature.." type ="text">
            <div class="ui basic label">
                °C
            </div>
        </div>
        <br>
        <br>

        <div class="ui selection dropdown">
              <input id="Cropdst" type="hidden">
              <i class="dropdown icon"></i>
              <div class="default text">Crop Density </div>
              <div class="menu">
                <div class="item" data-value="0">Low</div>
                <div class="item" data-value="1">Medium</div>
                <div class="item" data-value="2">High</div>
              </div>
        </div>
        <br>
        <br>
        <div class="ui selection dropdown">
              <input name="RegionRisk" type="hidden">
              <i class="dropdown icon"></i>
              <div class="default text">Regional Risk of Apothecial development </div>
              <div class="menu" id="RegionRisk">
                <div class="item" data-value="0">Low</div>
                <div class="item" data-value="1">Medium</div>
                <div class="item" data-value="2">High</div>
              </div>
        </div>  
        <br>
        <br>

        <span class="title-main"class="ui header">Click submit when finished</span>
        <div>
        <br>
        <button id ="ProcessData" class="positive ui button">Submit</button>
        </div> 

        </div>

        <div class="ui segment">  
        <h3>  3.Download Datasets </h3> 

        <div id="tifResponse1"></div>
        <div id="button1" class=""></div>
        <br>
        <div id="tifResponse2"></div>
        <div id="button2" class=""></div>
        <br>
        <div id="tifResponse3"></div>
        <div id="button3" class=""></div> 
        <br>
                
        </div>

    </div>

   <div data-tab= "second" class="ui bottom attached tab segment">
            <h3>  1.Select an Area of Interest for Corn by Clicking </h3>                    
        <div class="ui segment">  
        <span class="title-main"class="ui header">Click submit when finished</span>
        <div>
        <br>
        <button id ="AoiData" class="positive ui button">Submit</button>
        </div> 
        </div>


        <h3>  2.Enter required Data </h3>             


    <div class="ui segment">  
        <div class="ui right labeled input">
            <input placeholder ="Enter rainfall.." type ="text">
            <div class="ui basic label">
                mm
            </div>
        </div>
        <br>
        <br>

        <div class="ui right labeled input">
            <input id ="temperature" placeholder ="Enter temperature.." type ="text">
            <div class="ui basic label">
                °C
            </div>
        </div>
        <br>
        <br>

        <div class="ui selection dropdown">
              <input id="Cropdst" type="hidden">
              <i class="dropdown icon"></i>
              <div class="default text">Crop Density </div>
              <div class="menu">
                <div class="item" data-value="0">Low</div>
                <div class="item" data-value="1">Medium</div>
                <div class="item" data-value="2">High</div>
              </div>
        </div>
        <br>
        <br>
        <div class="ui selection dropdown">
              <input name="RegionRisk" type="hidden">
              <i class="dropdown icon"></i>
              <div class="default text">Regional Risk of Apothecial development </div>
              <div class="menu" id="RegionRisk">
                <div class="item" data-value="0">Low</div>
                <div class="item" data-value="1">Medium</div>
                <div class="item" data-value="2">High</div>
              </div>
        </div>  
        <br>
        <br>

        <span class="title-main"class="ui header">Click submit when finished</span>
        <div>
        <br>
        <button id ="ProcessData" class="positive ui button">Submit</button>
        </div> 

        </div>

        <div class="ui segment">  
        <h3>  3.Download Datasets </h3> 

        <div id="tifResponse1"></div>
        <div id="button1" class=""></div>
        <br>
        <div id="tifResponse2"></div>
        <div id="button2" class=""></div>
        <br>
        <div id="tifResponse3"></div>
        <div id="button3" class=""></div> 
        <br>
                
        </div>                           

    </div>

   <div data-tab= "third"  class="ui bottom attached tab segment">
        <h3>  1.Select an Area of Interest for Wheat by Clicking </h3>                    
        <div class="ui segment">  
        <span class="title-main"class="ui header">Click submit when finished</span>
        <div>
        <br>
        <button id ="AoiData" class="positive ui button">Submit</button>
        </div> 
        </div>


        <h3>  2.Enter required Data </h3>             


    <div class="ui segment">  
        <div class="ui right labeled input">
            <input placeholder ="Enter rainfall.." type ="text">
            <div class="ui basic label">
                mm
            </div>
        </div>
        <br>
        <br>

        <div class="ui right labeled input">
            <input id ="temperature" placeholder ="Enter temperature.." type ="text">
            <div class="ui basic label">
                °C
            </div>
        </div>
        <br>
        <br>

        <div class="ui selection dropdown">
              <input id="Cropdst" type="hidden">
              <i class="dropdown icon"></i>
              <div class="default text">Crop Density </div>
              <div class="menu">
                <div class="item" data-value="0">Low</div>
                <div class="item" data-value="1">Medium</div>
                <div class="item" data-value="2">High</div>
              </div>
        </div>
        <br>
        <br>
        <div class="ui selection dropdown">
              <input name="RegionRisk" type="hidden">
              <i class="dropdown icon"></i>
              <div class="default text">Regional Risk of Apothecial development </div>
              <div class="menu" id="RegionRisk">
                <div class="item" data-value="0">Low</div>
                <div class="item" data-value="1">Medium</div>
                <div class="item" data-value="2">High</div>
              </div>
        </div>  
        <br>
        <br>

        <span class="title-main"class="ui header">Click submit when finished</span>
        <div>
        <br>
        <button id ="ProcessData" class="positive ui button">Submit</button>
        </div> 


        </div>


        <div class="ui segment">  
        <h3>  3.Download Datasets </h3> 

        <div id="tifResponse1"></div>
        <div id="button1" class=""></div>
        <br>
        <div id="tifResponse2"></div>
        <div id="button2" class=""></div>
        <br>
        <div id="tifResponse3"></div>
        <div id="button3" class=""></div> 
        <br>
                
        </div>
    </div>     


   <div data-tab= "fourth"  class="ui bottom attached tab segment">               
        <div class="ui segment" id="text-block" >  
            <img src="../../data/aafc.png" style="width:200px;height:100px">
              <h1> About Plant Disease Network </h1> 
            <p>
            A plant disease is usually defined as abnormal growth and/or dysfunction of a plant. Diseases are
            the result of some disturbance in the normal life process of the plant. Diseases may be the result of
            living and/or non-living causes. Biotic diseases are caused by living organisms (e.g., fungi, bacteria,
            and viruses). Manage and predict plant disease has long been a challenge for farmers.
            </p>
            <p>
            AAFC(Agriculture and Agri-food Canada) is keen to develope a live Web-GIS system to help indicate
            potential risk for certain areas based on a spatial model.
            </p> 
        </div>
    </div> 



</div>

<div id="map-container">
      <div class="map pusher">
        <div id="map" class="map"></div>
      </div>

</div>




    <script>
        /****************************  Semantic-UI jQuery support *****************************/
        /* 
         
        Semantic UI dependency code works in conjunction with class definitions
        to generate animation and user interaction with classes
         
        */
        // initialize the tabs for data process
        $(' .menu .item')
            .tab();
        $('.ui.dropdown')
            .dropdown();
        
        /****************************  Define Map Layers and Map  *****************************/
        console.log("5");
       var view = new ol.View({
          //change projection to geoserver's projection
          projection: "EPSG:4326",
          center: [-98.5284468774974,52.71391708013823],
                zoom: 7
        });
        // creating a openlayer base map
        var osm_map = new ol.layer.Tile({
          source: new ol.source.OSM()
        });
        // creating a map layer from own server
        var vector_source = new ol.source.Vector({
              url: 'http://ulysses.gis.agr.gc.ca/geoserver/manitoba/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=manitoba:GeoBase_MUNI_MB_1_0_eng&maxFeatures=5000&outputFormat=application%2Fjson',
              format: new ol.format.GeoJSON()
          });

        var vector_map = new ol.layer.Vector({
          source: vector_source

        });

            // Get the array of features
        var features = vector_map.getSource().getFeatures();

        // Go through this array and get coordinates of their geometry.
        features.forEach(function(feature) {
           console.log(feature.getGeometry().getCoordinates());
        });

        
        var map = new ol.Map({

            layers: [osm_map, vector_map],
            target: 'map',
            view: view
        
        });
       // select region from JSON vector data            
        
        var coords;
        var select = new ol.interaction.Select();
            map.addInteraction(select);

        // var selectedFeature = select.getFeatures();
        selectclick = select;
        selectclick.on('select', function(e)
        { 
          console.log(e);
          if (e!== null)
          {
          console.log(e),
          coords = e.selected[0].f.target.l;
          console.log(coords);
          }
        });

        
/****************************  Download data locally     *****************************/
        
        $("#AoiData").click(function()
          { console.log(coords);
          $.post("../lib/php/riskDownload.php", 
          { 
               minX: String(coords[0]),
               minY: String(coords[1]),
               maxX: String(coords[2]),
               maxY: String(coords[3]),
          })
          .done(function(data, status)
          {
              $("#status").html("done");
              data = jQuery.parseJSON(data);
              console.log(data);
//&& data[1]
              if (data[0]&&data[1])
              { console.log(data[0]);
                $("#tifResponse1").html('<a href="' + data[0] + '" class="button" download=>Download Soil Data</a>').appendTo('#button1');
                $("#tifResponse2").html('<a href="' + data[1] + '" class="button" download=>Download Cropping History Data</a>').appendTo('#button2');
              }
          })
          });
      // changeInteraction();
/****************************  Process data using model     *****************************/
        $("#ProcessData").click(function()
          {
          // var floweringDate = document.getElementById("floweringDate").value;
          // console.log(floweringDate);
          var CropDensity = document.getElementById("Cropdst").value;
          $.post("../lib/php/riskAnalysis.php", 
          {    
               CropDensity:CropDensity
          })
          .done(function(data, status)
          {
              $("#status").html("done");
              data = jQuery.parseJSON(data);
              // console.log(data);
//&& data[1]
              if (data)
              {
                $("#tifResponse3").html('<a href="' + data + '" class="button" download=>Download risk Data</a>').appendTo('#button3');
              }
          })
          });
        


    </script>
</body>

</html>
